sudo: required
language: python
services: docker
install:
- pip install -r ./infrastructure/requirements-testsuite.txt
- docker-compose build
- docker-compose up -d
script:
- linkchecker --anchors --cookies --check-html --check-css http://localhost:5000
after_success:
- docker login -u ${ECR_USER} -p ${ECR_PASS} ${ECR_URL}
- docker tag flask_docker_lab:latest ${ECR_DNS}/flask_docker_lab:latest
- docker push ${ECR_DNS}/flask_docker_lab_ecr:latest

# REMOVE THE FOLLOWING BEFORE LAB COMMIT
before_install:
- openssl aes-256-cbc -K $encrypted_771bca74694a_key -iv $encrypted_771bca74694a_iv
  -in ecr.secret.enc -out ecr.secret -d
